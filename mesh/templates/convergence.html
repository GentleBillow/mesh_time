<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>MeshTime – Split Charts</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: sans-serif; margin: 20px; }
.card { display:inline-block; margin:10px; padding:10px; border:1px solid #ccc; }
canvas { max-width: 900px; }
</style>
</head>

<body>

<h2>MeshTime – Split API Dashboard</h2>

<div class="card" id="status">loading…</div>

<canvas id="conv"></canvas>
<canvas id="hist"></canvas>
<canvas id="rtt"></canvas>

<script>
async function fetchJSON(url) {
  const r = await fetch(url);
  return await r.json();
}

// ---------------- STATUS ----------------
async function updateStatus() {
  const s = await fetchJSON("/api/status");
  document.getElementById("status").innerText =
    `samples=${s.samples} | window=${s.window_s}s | max|θ|=${s.max_abs_ms.toFixed(3)} ms`;
}

// ---------------- CONVERGENCE ----------------
const convChart = new Chart(
  document.getElementById("conv"),
  { type: "line", data: { datasets: [] } }
);

async function updateConv() {
  const data = await fetchJSON("/api/chart/convergence");
  convChart.data.datasets = data.map(d => ({
    label: d.id,
    data: d.t.map((t,i)=>({x:t, y:d.theta[i]})),
    borderWidth: 1,
    fill: false
  }));
  convChart.update();
}

// ---------------- HISTOGRAM ----------------
const histChart = new Chart(
  document.getElementById("hist"),
  { type: "bar", data: { labels: [], datasets: [] } }
);

async function updateHist() {
  const h = await fetchJSON("/api/chart/histogram");
  histChart.data.labels = h.values.map((_,i)=>i);
  histChart.data.datasets = [{
    label: "θ samples",
    data: h.values
  }];
  histChart.update();
}

// ---------------- RTT ----------------
const rttChart = new Chart(
  document.getElementById("rtt"),
  { type: "line", data: { datasets: [] } }
);

async function updateRTT() {
  const data = await fetchJSON("/api/chart/rtt");
  rttChart.data.datasets = data.map(d => ({
    label: d.id,
    data: d.t.map((t,i)=>({x:t, y:d.rtt[i]})),
    borderWidth: 1
  }));
  rttChart.update();
}

// ---------------- LOOP ----------------
async function loop() {
  await Promise.all([
    updateStatus(),
    updateConv(),
    updateHist(),
    updateRTT()
  ]);
}

setInterval(loop, 1000);
loop();
</script>

</body>
</html> 
